"""
癌症生存分析可视化平台启动脚本
运行说明和平台配置
"""

# 癌症生存分析模型对比可视化平台

这是一个基于Streamlit的交互式Web应用，用于展示和对比DeepSurv深度学习模型与传统机器学习模型（Cox回归和随机生存森林）在癌症生存分析中的性能。

## 功能特性

### 1. 数据概览
- 数据集基本统计信息
- 年龄分布可视化
- 生存状态分布
- 随访时间统计

### 2. 模型性能对比
- C-index性能对比图表
- 模型排名表
- 风险分层显著性检验结果
- 最佳模型推荐

### 3. 生存分析
- 交互式模型选择
- 风险分层生存曲线
- Kaplan-Meier估计
- 风险组统计信息

### 4. 风险分析
- 风险得分分布对比
- 模型预测相关性分析
- 风险得分统计摘要
- 按生存状态分组的箱线图

### 5. 交互式预测
- 患者特征输入界面
- 实时风险预测
- 风险因素贡献分析
- 风险等级可视化

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 数据准备
确保以下数据文件存在：
- `../data/processed/modeling_data.csv`
- `../data/processed/train_data.csv`
- `../data/processed/test_data.csv`
- `../data/processed/deepsurv_predictions.csv`
- `../data/processed/cox_predictions.csv`
- `../data/processed/rsf_predictions.csv`
- `../data/processed/comprehensive_evaluation_results.csv`
- `../data/processed/preprocessors.pkl`

### 3. 启动应用
```bash
streamlit run streamlit_app.py
```

### 4. 访问应用
打开浏览器访问 `http://localhost:8501`

## 技术架构

### 前端框架
- **Streamlit**: 主要Web框架
- **Plotly**: 交互式图表
- **Bootstrap CSS**: 样式美化

### 数据处理
- **Pandas**: 数据操作
- **NumPy**: 数值计算
- **Lifelines**: 生存分析

### 可视化组件
1. **性能对比图表**: 条形图、箱线图
2. **生存曲线**: Kaplan-Meier曲线
3. **相关性热图**: 模型预测相关性
4. **分布图**: 风险得分分布

## 使用指南

### 导航菜单
左侧边栏提供五个主要页面的导航：

1. **📊 数据概览**: 了解数据集的基本特征
2. **🔬 模型对比**: 查看模型性能排名和对比
3. **📈 生存分析**: 分析不同模型的风险分层效果
4. **⚠️ 风险分析**: 深入了解风险得分分布
5. **🎯 交互预测**: 体验模型的实时预测功能

### 交互功能
- **模型选择**: 在生存分析页面选择不同模型查看结果
- **参数调整**: 在交互预测页面调整患者特征
- **图表缩放**: 支持Plotly图表的缩放和悬停
- **数据筛选**: 动态筛选和排序功能

## 模型说明

### DeepSurv模型
- 基于深度神经网络的生存分析模型
- 使用Cox比例风险函数作为损失函数
- 能够自动学习非线性特征交互

### Cox回归模型
- 经典的比例风险回归模型
- 基于线性假设的传统统计方法
- 具有良好的可解释性

### 随机生存森林
- 基于决策树的集成学习方法
- 能够处理非线性关系和特征交互
- 提供特征重要性排序

## 评估指标

### C-index (Concordance Index)
衡量模型预测排序与实际生存时间排序的一致性，值越高表示模型性能越好。

### 风险分层能力
通过Log-rank检验评估模型将患者分为不同风险组的能力。

### Brier Score
衡量预测概率与实际结果的差异，值越低表示预测越准确。

## 注意事项

1. **数据隐私**: 所有数据均为模拟数据，不涉及真实患者信息
2. **模型局限**: 预测结果仅供研究参考，不可用于实际临床决策
3. **性能优化**: 大数据集可能影响页面加载速度
4. **浏览器兼容**: 推荐使用Chrome或Firefox浏览器

## 技术支持

如遇问题，请检查：
1. Python环境和依赖包安装
2. 数据文件路径和格式
3. 浏览器JavaScript支持
4. 网络连接状态

## 版本信息

- 版本: 1.0.0
- 更新日期: 2024
- 作者: 癌症生存分析研究项目组